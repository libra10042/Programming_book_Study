## ğŸª” ì„œë¹„ìŠ¤ ì¶”ìƒí™” ì ìš©

> ìë°”ì—ëŠ” JAXB ì™¸ì—ë„ ë‹¤ì–‘í•œ XMLê³¼ ìë°”ì˜¤ë¸Œì íŠ¸ë¥¼ ë§¤í•‘í•˜ëŠ” ê¸°ìˆ ì´ ìˆë‹¤. í•„ìš”ì— ë”°ë¼ ë‹¤ë¥¸ ê¸°ìˆ ë¡œ ì†ì‰½ê²Œ ë°”ê¿”ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì•¼ í•œë‹¤.
> XML íŒŒì¼ì„ ì¢€ ë” ë‹¤ì–‘í•œ ì†ŒìŠ¤ì— ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ ë§Œë“ ë‹¤.


### â˜‘ OXM(Object-XML-Mapping) ì„œë¹„ìŠ¤ ì¶”ìƒí™” 

> 1. OXM ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤
> 2. JAXB êµ¬í˜„ í…ŒìŠ¤íŠ¸ 
> 3. Castor êµ¬í˜„ í…ŒìŠ¤íŠ¸ 



JAXB ì™¸ì— ì‹¤ì „ì— ìì£¼ ì‚¬ìš©ë˜ëŠ” XMLê³¼ ìë°”ì˜¤ë¸Œì íŠ¸ ë§¤í•‘ ê¸°ìˆ . 

- 1) Castor XML 
- 2) JiBx
- 3) XmlBeans
- 4) Xstream

" OXM í”„ë ˆì„ì›Œí¬ì™€ ê¸°ìˆ ë“¤ì€ ê¸°ëŠ¥ ë©´ì—ì„œ ìƒí˜¸ í˜¸í™˜ì„±ì´ ìˆë‹¤. JAXBë¥¼ í¬í•¨í•´ì„œ ë‹¤ì„¯ ê°€ì§€ ê¸°ìˆ  ëª¨ë‘ ì‚¬ìš© ëª©ì ì´ ë™ì¼í•˜ê¸° ë•Œë¬¸ì— ìœ ì‚¬í•œ ê¸°ëŠ¥ê³¼ API ë¥¼ ì œê³µí•œë‹¤. "

<br>

âœğŸ» ìŠ¤í”„ë§ì€ íŠ¸ëœì­ì…˜, ë©”ì¼ ì „ì†¡ë¿ ì•„ë‹ˆë¼ OXM ì— ëŒ€í•´ì„œë„ ì„œë¹„ìŠ¤ ì¶”ìƒí™” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. 
<br> ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” OXM ì¶”ìƒ ê³„ì¸µì˜ APIë¥¼ ì´ìš©í•´ XML ë¬¸ì„œì™€ ì˜¤ë¸Œì íŠ¸ ì‚¬ì´ì˜ ë³€í™˜ì„ ì²˜ë¦¬í•˜ê²Œ í•˜ë©´, ì½”ë“œ ìˆ˜ì • ì—†ì´ë„ OXM ê¸°ìˆ ì„ ììœ ë¡­ê²Œ ë°”ê¿”ì„œ ì ìš©í•  ìˆ˜ ìˆë‹¤.

### 1. OXM ì„œë¹„ìŠ¤ ì¸í„°í˜ì´ìŠ¤

: ìë°” ì˜¤ë¸Œì íŠ¸ë¥¼ xmlë¡œ ë³€í™˜í•˜ëŠ” Marshallerì™€, ë°˜ëŒ€ë¡œ XMLì„ ìë°”ì˜¤ë¸Œì íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” Unmarshallerì´ ìˆë‹¤.

##### Unmarshaller ì¸í„°í˜ì´ìŠ¤

```java
package org.springframework.oxm;
...
import java.xml.transform.Source; 

public interface Unmarshaller {
    boolean supports(Class<?> clazz);   // í•´ë‹¹ í´ë˜ìŠ¤ë¡œ ì–¸ë§ˆìƒ¬ì´ ê°€ëŠ¥í•œì§€ í™•ì¸í•´ì¤€ë‹¤.ë³„ë¡œ ì‚¬ìš©í•  ì¼ì€ ì—†ë‹¤.
    
    Object unmarshal(Source source) throws IOException, XmlMappingException; 
}
```
" Unmarshaller ì¸í„°í˜ì´ìŠ¤ <br> : XML íŒŒì¼ì— ëŒ€í•œ ì •ë³´ë¥¼ ë‹´ì€ Source íƒ€ì…ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ì£¼ë©´, ì„¤ì •ì—ì„œ ì§€ì •í•œ OXM ê¸°ìˆ ì„ ì´ìš©í•´ ìë°” ì˜¤ë¸Œì íŠ¸ íŠ¸ë¦¬ë¡œ ë³€í™˜í•˜ê³ , ë£¨íŠ¸ ì˜¤ë¸Œì íŠ¸ë¡œ ëŒë ¤ì¤€ë‹¤. 
"

<br>

### 2. JAXB êµ¬í˜„ í…ŒìŠ¤íŠ¸ 

: JAXBë¥¼ ì´ìš©í•˜ë„ë¡ ë§Œë“¤ì–´ì§„ Unmarshaller êµ¬í˜„ í´ë˜ìŠ¤ëŠ” Jaxb2Marshallerì´ë‹¤. <br>
( Jaxb2Marshaller í´ë˜ìŠ¤ëŠ” Unmarshaller ì¸í„°í˜ì´ìŠ¤ì™€ Marshaller ì¸í„°í˜ì´ìŠ¤ë¥¼ ëª¨ë‘ êµ¬í˜„í•˜ê¸° ìˆë‹¤.) 

##### JAXBìš© Unmarshaller ë¹ˆ ì„¤ì •. 

```java
<? xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <bean id="unmarshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
        <property name="contextPath" value="springbook.user.sqlservice.jaxb" />
    </bean>
</beans>
```

##### OXM ì–¸ë§ˆìƒ¬ë§ í…ŒìŠ¤íŠ¸ ì½”ë“œ 

```JAVA
package springbook.learningtest.spring.oxm;
...
import org.springframework.oxm.Unmarshaller;  // JAXB API ë“±ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì–¸ë§ˆìƒ¬ëŸ¬ì™€ í´ë˜ìŠ¤ ì´ë¦„ì´ ê°™ìœ¼ë¯€ë¡œ ì„í¬íŠ¸í•  ë•Œ ì£¼ì˜í•´ì•¼ í•œë‹¤.
import javax.xml.transform.stream.StreamSource; 

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
public class OxmTest { 

    @Autowired Unmarshaller unmarshaller; 
    
    @Test
    public void unmarshallSqlMap() throws XmlMappingException, IOException {
    
        Source xmlSource = new StreamSource(
              getClass().getResourceAsStream("sqlmap.xml"));
              
        Sqlmap sqlmap = (Sqlmap) this.unmarshaller.unmarshal(xmlSource); 
        
        List<SqlType> sqlList = sqlmap.getSql();
        
        List<SqlType> sqlList = sqlmap.getSql();
        assertThat(sqlList.size(), is(3));
        assertThat(sqlList.get(0).getKey(), is("add"));
        
        ...
        assertThat(sqlList.get(2).getValue(), is("delete"));
    }
}
```

" ìœ„ í…ŒìŠ¤íŠ¸ìš© ì½”ë“œëŠ” OXM ì¶”ìƒí™” ê³„ì¸µì„ ì´ìš©í–ˆë‹¤. ë”°ë¼ì„œ JAXBë¼ëŠ” ê¸°ìˆ ì— ì˜ì¡´í•˜ëŠ” ë¶€ë¶„ì€ ì‚¬ë¼ì¡Œë‹¤. "

### 3. Castor êµ¬í˜„ í…ŒìŠ¤íŠ¸ 

: ë§¤í•‘ì •ë³´ë§Œ ì ì ˆíˆ ë§Œë“¤ì–´ì£¼ë©´ ì–´ë–¤ í´ë˜ìŠ¤ì™€ í•„ë“œë¡œë„ ë§¤í•‘ì´ ê°€ëŠ¥í•˜ë‹¤. 

##### Castorìš© ë§¤í•‘ì •ë³´

```java
<?xml version="1.0"?>
<!DOCTYPE mapping PUBLIC "-//EXOLAB/Castor Mapping DTD Version 1.0/EN" 
        "http://castor.org/mapping.dtd">
<mapping>
    <class name="springbook.sqlservice.jaxb.Sqlmap">
        <map-to xml="sqlmap" />
        <field name="sql" type="springbook.sqlservice.jaxb.SqlType"
               required="true" collection="arraylist">
            <bind-xml name="sql" node="element" />
        </field>    
    </class>
    <class name="springbook.sqlservice.jaxb.SqlType">
        <map-to xml="sql" />
        <field name="key" type="string" required="true">
            <bind-xml name="key" node="attribute" />
        </field>
        <field name="value" type="string" required="true">
            <bind-xml node="text" />
        </field>
    </class>

</mapping>
```

##### Castor ê¸°ìˆ ì„ ì‚¬ìš©í•˜ëŠ” ì–¸ë§ˆìƒ¬ëŸ¬ ì„¤ì •.

: ummarshaller ë¹ˆì˜ í´ë˜ìŠ¤ë¥¼ Castorìš© êµ¬í˜„ í´ë˜ìŠ¤ë¡œ ë³€ê²½í•œë‹¤.

```java
<bean id="unmarshaller"
       class="org.springframework.oxm.castor.CastorMarshaller">
   <property name="mappingLocation"
            value="springbook/learningtest/spring/oxm/mapping.xml" />
</bean>
```

" ìœ„ì— ê²°ê³¼ë¥¼ í…ŒìŠ¤íŠ¸ í•´ë³´ë©´ í…ŒìŠ¤íŠ¸ ë‚´ì˜ ì–¸ë§ˆìƒ¬ëŸ¬ë¥¼ ì´ìš©í•˜ëŠ” ì½”ë“œëŠ” ì „í˜€ ë°”ë€Œì§€ ì•Šì•˜ì§€ë§Œ xml íŒŒì¼ì„ ì½ì–´ì„œ ë³€í™˜í•˜ëŠ” ê¸°ìˆ ì€ Castorë¡œ ì™„ë²½í•˜ê²Œ ì „í™˜ëë‹¤.  <br>

ì„œë¹„ìŠ¤ ì¶”ìƒí™”ëŠ” ì´ë ‡ê²Œ ë¡œìš°ë ˆë²¨ì˜ ê¸°ìˆ ì„ í•„ìš”ì— ë”°ë¼ ë³€ê²½í•´ì„œ ì‚¬ìš©í•˜ë”ë¼ë„ ì¼ê´€ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œë¥¼ ìœ ì§€í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤."

<br>

### â˜‘ OXM ì„œë¹„ìŠ¤ ì¶”ìƒí™” ì ìš© 

: ìŠ¤í”„ë§ì˜ OXM ì¶”ìƒí™” ê¸°ëŠ¥ì„ ì´ìš©í•˜ëŠ” SqlServiceë¥¼ ë§Œë“¤ì–´ë³´ì."

> 1. ë©¤ë²„ í´ë˜ìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ” í†µí•© í´ë˜ìŠ¤
> 2. OXM ì„œë¹„ìŠ¤ ì¶”ìƒí™” ì ìš©
> 3. ìœ„ì„ì„ ì´ìš©í•œ BaseSqlService ì˜ ì¬ì‚¬ìš©

<br>

### 1. ë©¤ë²„ í´ë˜ìŠ¤ë¥¼ ì°¸ì¡°í•˜ëŠ” í†µí•© í´ë˜ìŠ¤ 

: OxmSqlServiceëŠ” BaseSqlService ì™€ ìœ ì‚¬í•˜ê²Œ SqlReader íƒ€ì…ì˜ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•˜ë˜ ì´ë¥¼ ìŠ¤íƒœí‹± ë©¤ë²„ í´ë˜ìŠ¤ë¡œ ë‚´ì¥í•˜ê³  ìì‹ ë§Œì´ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ ë³´ì. 

##### OxmSqlService ê¸°ë³¸ êµ¬ì¡°

```java
package springbook.user.sqlservice; 

public class OxmSqlService implements SqlService {
    private final OxmSqlReader oxmSqlReader = new OxmSqlReader(); 
    ...
    
    private class OxmSqlReader implements SqlReader {
      ...
    }
}

```

âœğŸ» OxmsqlReader ëŠ” private ë©¤ë²„ í´ë˜ìŠ¤ì´ë¯€ë¡œ ì™¸ë¶€ì— ì ‘ê·¼í•˜ê±°ë‚˜ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.<br>
ë˜í•œ OxmSqlService ëŠ” ì´ë¥¼ final ë¡œ ì„ ì–¸í•˜ê³  ì§ì ‘ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— OxmSqlReaderë¥¼ DI í•˜ê±°ë‚˜ ë³€ê²½í•  ìˆ˜ ì—†ë‹¤. <br>

ë””í´íŠ¸ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” ë°©ì‹ì˜ í•œê³„ëŠ” ë””í´íŠ¸ë¡œ ë‚´ë¶€ì—ì„œ ë§Œë“œëŠ” ì˜¤ë¸Œì íŠ¸ì˜ í”„ë¡œí¼í‹°ë¥¼ ì™¸ë¶€ì—ì„œ ì§€ì •í•´ì£¼ê¸°ê°€ í˜ë“¤ë‹¤ëŠ” ì ì´ë‹¤. 

##### ë‚´ë¶€ ì˜¤ë¸Œì íŠ¸ì˜ í”„ë¡œí¼í‹°ë¥¼ ì „ë‹¬í•´ì£¼ëŠ” ì½”ë“œ

: OxmSqlService ì˜ í”„ë¡œí¼í‹°ë¥¼ í†µí•´ ë‚´ì¥ëœ ë©¤ë²„ í´ë˜ìŠ¤ì˜ í”„ë¡œí¼í‹°ë¥¼ ì„¤ì •í•´ì£¼ëŠ” ì½”ë“œë‹¤. 

```java
public class OxmSqlService implements SqlService {
    private final OxmSqlReader oxmSqlReader = new OxmSqlReader();
    ...
    public void setUnmarshaller(Unmarshaller unmarshaller){
        this.oxmSqlReader.setUnmarshaller(unmarshaller);
    }
    
    public void setUnmarshaller(Unmarshaller unmarshaller){
        this.oxmSqlReader.setSqlmapFile(sqlmapFile);
    }
    ...
    
    private class OxmSqlReader implements SqlReader {
        private Unmarshaller unmarshaller; 
        private String sqlmapFile; 
        // setter ë©”ì†Œë“œ ìƒëµ
        ...
    }
}
```

##### ì™„ì„±ëœ OxmSqlService í´ë˜ìŠ¤

: ì™„ì„±ëœ OxmSqlService í´ë˜ìŠ¤ë‹¤. 

```java
public class OxmSqlService implements SqlService {
    private final OxmSqlReader oxmSqlReader = new OxmSqlReader(); 
    
    private SqlRegistry sqlRegistry = new HashMapSqlRegistry();
    
    public void setSqlRegistry(SqlRegistry sqlRegistry){
        this.sqlRegistry = sqlRegistry; 
    }
    
    public void setUnmarshaller(Unmarshaller unmarshaller { ... }
    public void setSqlmapFile(String sqlmapFile) { ... }
    
    
    @PostConstruct
    public void loadSql() { this.oxmSqlReader.read(this.sqlRegistry); }
    
    public String getSql(String key) throws SqlRetrievalFailureException {
        try { 
            return this.sqlRegistry.findSql(key); 
            
        } catch (SqlNotFoundException e){
            throw new SqlRetrievalFailureException(e); 
        }
    }
    
    
    private class OxmSqlReader implements SqlReader {
    
        private Unmarshaller unmarshaller; 
        private final static String DEFAULT_SQLMAP_FILE = "sqlmap.xml";
        private String sqlmapFile = DEFAULT_SQLMAP_FILE;
        
        
        public void setUnmarshaller(Unmarshaller unmarshaller){
            this.unmarshaller = unmarshaller; 
        
        }
    
        public void setSqlmapFile(String sqlmapFile) { this. sqlmapFile = sqlmapFile; }
    
    
        public void read(SqlRegistry sqlRegistry{
            try { 
               Source source = new StreamSource( 
                        UserDao.class.getResourceAsStream(this.sqlmapFile));
               
               Sqlmap sqlmap = (Sqlmap) this.unmarshaller.unmarshal(source);
               
               for(SqlType sql : sqlmap.getSql()){
                    sqlRegistry.registerSql(sql.getKey(), sql.getValue());
    
               }            
            } catch (IOException e) {
                  throw new IllegalArgumentException(this.sqlmapFile + "ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", e);
            }        
        }
    }
}
```

##### OXMì„ ì ìš©í•œ SqlService ì„¤ì •. 

```java
<bean id="sqlService" class="springbook.user.sqlservice.OxmSqlSerivce">
    <property name="unmarshaller" ref="unmarshaller" />
</bean>
<bean>
    <property name="contextPath" value="springbook.user.sqlservice.jaxb" />
</bean>
``` 

<br>

### 3. ìœ„ì„ì„ ì´ìš©í•œ BaseSqlService ì˜ ì¬ì‚¬ìš©

##### BaseSqlService ë¡œì˜ ìœ„ì„ì„ ì ìš©í•œ OxmSqlService

```java
public class OxmSqlService implements SqlService { 
    private final BaseSqlService baseSqlService = new BaseSqlService(); 
    ...
    
    @PostConstruct
    public void loadSql(){
    
        this.baseSqlService.set
    
    }
    
    public String getSql(String key) throws SqlRetrievalFailureException {
        return this.baseSqlService.getSql(key);
    }
    


}
```

<br><br>

### ë¦¬ì†ŒìŠ¤ ì¶”ìƒí™”

: OxmSqlReader ë‚˜ XmlsqlReaderì—ëŠ” ê³µí†µì ì¸ ë¬¸ì œì ì´ ìˆë‹¤. <br>
SQL ë§¤í•‘ ì •ë³´ê°€ ë‹´ê¸´ XML íŒŒì¼ ì´ë¦„ì„ í”„ë¡œí¼í‹°ë¡œ ì™¸ë¶€ì—ì„œ ì§€ì •í•  ìˆ˜ ìˆì§€ë§Œ UserDao í´ë˜ìŠ¤ì™€ ê°™ì€ í´ë˜ìŠ¤íŒ¨ìŠ¤ì— ì¡´ì¬í•˜ëŠ” íŒŒì¼ë¡œ ì œí•œëœë‹¤. <br>

âœğŸ» URL í´ë˜ìŠ¤ëŠ” http, ftp, fileê³¼ ê°™ì€ ì ‘ë‘ì–´ë¥¼ ì§€ì •í•  ìˆ˜ ìˆì–´ì„œ ë‹¤ì–‘í•œ ì›ê²© ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.<br>
í•˜ì§€ë§Œ ìë°”ì˜ í´ë˜ìŠ¤íŒ¨ìŠ¤ ì•ˆì— ì¡´ì¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤ë‚˜ ì„œë¸”ë¦¿ ì»¨í…ìŠ¤íŠ¸ì˜ ë¦¬ì†ŒìŠ¤ ë˜ëŠ” ì„ì˜ì˜ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì§€ì •í•˜ëŠ” ë°©ë²•ì´ ì—†ë‹¤ëŠ” ì ê³¼ ë¦¬ì†ŒìŠ¤ íŒŒì¼ì˜ ì¡´ì¬ ì—¬ë¶€ë¥¼ ë¯¸ë¦¬ í™•ì¸í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ ì—†ë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤. <br>


> 1. ë¦¬ì†ŒìŠ¤
> 2. ë¦¬ì†ŒìŠ¤ ë¡œë”
> 3. Resourceë¥¼ ì´ìš©í•´ XML íŒŒì¼ ê°€ì ¸ì˜¤ê¸° 

<br>

### 1. ë¦¬ì†ŒìŠ¤ 

: ìŠ¤í”„ë§ì€ ìë°”ì— ì¡´ì¬í•˜ëŠ” ì¼ê´€ì„± ì—†ëŠ” ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ APIë¥¼ ì¶”ìƒí™”í•´ì„œ Resourceë¼ëŠ” ì¶”ìƒí™” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í–ˆë‹¤. 

##### Resource ì¸í„°í˜ì´ìŠ¤

```java
public interface Resource extends InputStreamSource {
    boolean exists();
    boolean isReadable();
    boolean isOpen(); 
    
    URL getURL() throws IOException; 
    URI getURI() throws IOException; 
    File getFile() throws IOException; 
    
    Resource createRelative(String relativePath) throws IOException; 
    
    
    long lastModified() throws IOException; 
    String getFilename(); 
    String getDescription();
}


public interface InputStreamSource { 
    InputStream getInputStream() throws IOException;
}
```

" ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ì¶”ìƒí™”ì˜ ì˜¤ë¸Œì íŠ¸ì™€ëŠ” ë‹¬ë¦¬ ResourceëŠ” ìŠ¤í”„ë§ì—ì„œ ë¹ˆì´ ì•„ë‹ˆë¼ ê°’ìœ¼ë¡œ ì·¨ê¸‰ëœë‹¤. <br>
ë¦¬ì†ŒìŠ¤ëŠ” OXMì´ë‚˜ íŠ¸ëœì­ì…”ë„ˆëŸ¼ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•´ì£¼ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë‹¨ìˆœí•œ ì •ë³´ë¥¼ ê°€ì§„ ê°’ìœ¼ë¡œ ì§€ì •ëœë‹¤." 

<br>

### 2. ë¦¬ì†ŒìŠ¤ ë¡œë” 

: ë”°ë¼ì„œ ìŠ¤í”„ë§ì—ëŠ” URL í´ë˜ìŠ¤ì™€ ìœ ì‚¬í•˜ê²Œ ì ‘ë‘ì–´ë¥¼ ì´ìš©í•´ Resource ì˜¤ë¸Œì íŠ¸ë¥¼ ì„ ì–¸í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤. <br>
URLì•ˆì— ë¦¬ì†ŒìŠ¤ì˜ ì¢…ë¥˜ì™€ ë¦¬ì†ŒìŠ¤ì˜ ìœ„ì¹˜ë¥¼ í•¨ê»˜ í‘œí˜„ í•´ì£¼ëŠ” ê²ƒì´ë‹¤.

##### ResourceLoader ì¸í„°í˜ì´ìŠ¤

```JAVA
package org.springframework.core.io;

public interface ResourceLoader {
    Resource getResource(String location);  
    ...
}   

```

<br>

âœğŸ» ResourceLoaderì˜ ëŒ€í‘œì ì¸ ì˜ˆëŠ” ë°”ë¡œ ìŠ¤í”„ë§ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ë‹¤.<br>
ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ê°€ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ì¸ ApplicationContext ëŠ” ResourceLoader ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•˜ê³  ìˆë‹¤. ë”°ë¼ì„œ ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ëŠ” ë¦¬ì†ŒìŠ¤ ë¡œë”ì´ê¸°ë„ í•˜ë‹¤.
<br>

> ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” ë¦¬ì†ŒìŠ¤ ë¡œë”ë¥¼ ë‹¤ì–‘í•œ ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ê°€ ì‚¬ìš©í•  ìŠ¤í”„ë§ ì„¤ì •ì •ë³´ê°€ ë‹´ê¸´ xml íŒŒì¼ë„ ë¦¬ì†ŒìŠ¤ ë¡œë”ë¥¼ ì´ìš©í•´ Resource
> í˜•íƒœë¡œ ì½ì–´ì˜¨ë‹¤.ê·¸ ë°–ì—ë„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ê°€ ì™¸ë¶€ì—ì„œ ì½ì–´ì˜¤ëŠ” ëª¨ë“  ì •ë³´ëŠ” ë¦¬ì†ŒìŠ¤ ë¡œë”ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ì–´ ìˆë‹¤.

##### í´ë˜ìŠ¤ íŒ¨ìŠ¤ì™€ íŒŒì¼ ì‹œìŠ¤í…œ, ì›¹ ì„œë²„ ë¦¬ì†ŒìŠ¤ ì§€ì •

```java
<property name="myFile" value="classpath:com/epril/myproject/myfile.txt" />
<property name="myFile" value="file:/data/myfile.txt" />
<property name-"myFile" value="http://www.myserver.com/test.dat" />
```



<br>

### 3. Resource ë¥¼ ì´ìš©í•´ XML íŒŒì¼ ê°€ì ¸ì˜¤ê¸° 

: OxmSqlServiceì— Resourceë¥¼ ì ìš©í•´ì„œ SQL ë§¤í•‘ì •ë³´ê°€ ë‹´ê¸´ íŒŒì¼ì„ ë‹¤ì–‘í•œ ìœ„ì¹˜ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. 

##### Resource ì ìš©

* ì•„ë˜ëŠ” Resourceë¥¼ ì ìš©í•œ OxmSqlService ì½”ë“œì´ë‹¤.

: ì¼ë‹¨ ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë˜ì–´ ìˆë˜ sqlmapFile í”„ë¡œí¼í‹°ë¥¼ ëª¨ë‘ Resource íƒ€ì…ìœ¼ë¡œ ë°”ê¾¼ë‹¤.<br>
Resource íƒ€ì…ì€ ì‹¤ì œ ì†ŒìŠ¤ê°€ ì–´ë–¤ ê²ƒì´ë“  ìƒê´€ì—†ì´ getInputStream() ë©”ì†Œë“œë¥¼ ì´ìš©í•´ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

```JAVA
public class OxmSqlService implements SqlService {
    public void setSqlmap(Resource sqlmap){
        this.oxmSqlReader.setSqlmap(sqlmap); 
    }
    ...
    
    private class OxmSqlReader implements SqlReader {
    
        private Resource sqlmap = new ClassPathResource("sqlmap.xml", UserDao.class); 
        
        public void setSqlmap(Resource sqlmap){
            this.sqlmap = sqlmap; 
        }
        
        
        public void read(SqlRegistry sqlRegistry){
        
            try{
                Source source = new StreamSource(sqlmap.getInputStream()); 
                ...
            
            }catch (IOException e){
                throw new IllegalArgumentException(this.sqlmap.getFilename() + "ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤", e);             }   
        }   
    }
}
```

* ì—¬ê¸°ì„œ ResourceëŠ” ë‹¨ì§€ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì¶”ìƒí™”ëœ í•¸ë“œëŸ¬ì¼ ë¿ì´ë‹¤.ë”°ë¼ì„œ Resource íƒ€ì…ì˜ ì˜¤ë¸Œì íŠ¸ê°€ ë§Œë“¤ì–´ì¡Œë‹¤ê³  í•´ë„ ì‹¤ì œë¡œ ë¦¬ì†ŒìŠ¤ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.

##### classpath: ì ‘ë‘ì–´ë¥¼ ì´ìš©í•´ ì§€ì •í•œ ë¦¬ì†ŒìŠ¤

```java
<bean id="sqlService" class="springbook.user.sqlservice.OxmSqlService">
       <property name="unmarshaller" ref="unmarshaller" />
       <property name="sqlmap" value="classpath:springbook/user/dao/sqlmap.xml" />      
</bean>

```

##### file: ì ‘ë‘ì–´ë¥¼ ì´ìš©í•´ ì§€ì •í•œ ë¦¬ì†ŒìŠ¤

 : classpath:ë¥¼ ì‚¬ìš©í–ˆì„ ë•ŒëŠ” í´ë˜ìŠ¤íŒ¨ìŠ¤ ë£¨íŠ¸ë¡œë¶€í„° ìƒëŒ€ì ì¸ ìœ„ì¹˜ì§€ë§Œ, file: ì„ ì‚¬ìš©í•˜ë©´ íŒŒì¼ ì‹œìŠ¤í…œì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¡œë¶€í„° ì‹œì‘í•˜ëŠ” íŒŒì¼ ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.
 
```java 
<bean id="sqlService" class="springbook user.sqlservice.OxmSqlService">
    <property name="unmarshaller" ref="unmarshaller" />
    <property name="sqlmap" value="file:/opt/resources/sqlamp.xml" />  
</bean>
```


##### HTTP ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ ë¦¬ì†ŒìŠ¤

: ê³µê°œì ì¸ ì›¹ ì„œë²„ì—ì„œ SQL ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ì¼ì´ì•¼ ì•„ë§ˆë„ ì—†ê² ì§€ë§Œ, ê¸°ì—…ì˜ DB ê´€ë ¨ ì •ë³´ë¥¼ ê´€ë¦¬í•˜ëŠ” ë‚´ë¶€ ì„œë²„ê°€ ìˆë‹¤ë©´ SQL ì •ë³´ë¥¼ HTTP í”„ë¡œí† ì½œë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ í•˜ëŠ” ê±´ ì¢‹ì€ ë°©ë²•ì´ë‹¤. 

```JAVA
<bean id="sqlService" class="springbook.user.sqlservice.OxmSqlService">
    <property name="unmarshaller" ref="unmarshaller" />
    <property name="sqlmap" value="http://www.epril.com/resources/sqlmap.xml" />   
</bean>
```

----

## ğŸª” ì¸í„°í˜ì´ìŠ¤ ìƒì†ì„ í†µí•œ ì•ˆì „í•œ ê¸°ëŠ¥í™•ì¥. 



### â˜‘ DI ê¸°ëŠ¥ì˜ í™•ì¥. 

- 1) DIë¥¼ ì˜ì‹í•˜ëŠ” ì„¤ê³„ 
- 2) DIì™€ ì¸í„°í˜ì´ìŠ¤ í”„ë¡œê·¸ë˜ë° 

### â˜‘ ì¸í„°í˜ì´ìŠ¤ ìƒì† 

----

## ğŸª” DIë¥¼ ì´ìš©í•´ ë‹¤ì–‘í•œ êµ¬í˜„ ë°©ë²• ì ìš©í•˜ê¸° 

### â˜‘ ConcurrentHashMapì„ ì´ìš©í•œ ìˆ˜ì • ê¸°ëŠ¥ SQL ë ˆì§€ìŠ¤íŠ¸ë¦¬ 

> 1. ìˆ˜ì • ê¸°ëŠ¥ SQL ë ˆì§€ìŠ¤íŠ¸ë¦¬ í…ŒìŠ¤íŠ¸ 
> 2. ìˆ˜ì • ê¸°ëŠ¥ SQL ë ˆì§€ìŠ¤íŠ¸ë¦¬ êµ¬í˜„ 

### â˜‘ ë‚´ì¥í˜• DBë¥¼ ì´ìš©í•œ SQL ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë§Œë“¤ê¸°. 

> 1. ìŠ¤í”„ë§ì˜ ë‚´ì¥í˜• DB ì§€ì› ê¸°ëŠ¥. 
> 2. ë‚´ì¥í˜• DB ë¹Œë” í•™ìŠµ í…ŒìŠ¤íŠ¸ 
> 3. ë‚´ì¥í˜• DBë¥¼ ì´ìš©í•œ SqlRegistry ë§Œë“¤ê¸°
> 4. UpdatableSqlRegustry í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ ì¬ì‚¬ìš©
> 5. XML ì„¤ì •ì„ í†µí•œ ë‚´ì¥í˜• DBì˜ ìƒì„±ê³¼ ì ìš© 


### â˜‘ íŠ¸ëœì­ì…˜ ì ìš©

> 1. ë‹¤ì¤‘ SQL ìˆ˜ì •ì— ëŒ€í•œ íŠ¸ëœì­ì…˜ í…ŒìŠ¤íŠ¸ 
> 2. ì½”ë“œë¥¼ ì´ìš©í•œ íŠ¸ëœì­ì…˜ ì ìš©


<br><br>

