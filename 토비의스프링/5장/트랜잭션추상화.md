# 트랜잭션 서비스 추상화 
--- 
#### UserService의 테스트용 대역 클래스
```
static Class TestUserService extends UserService { 
    private String id; 
    
    private TestUserService(String id){
        this.id = id;       
    }

    protected void upgradedLevel(User user){          
        if(user.getId().equals(this.id)) throw new TestUserServiceException();
        super.upgradeLevel(user);
    }

}
```

```
statis class TestUserServiceException extends RuntimeException {
}
```
<br>

## 강제예외발생을 통한 테스트

##### 예외 발생 시 작업 취소 여부 테스트
```
@Test
public void upgradeAllOrNoting(){
    userservice testUserService = new TestUserService(users.get(3).getId());
    testUserService.setUserDao(this.userDao); 
    userDao.deleteAll();
    for(User user : users) userDao.add(user);
    
    try {
        testUserService.upgradeLevels();
        fail("TestUserServiceException expected");
    
    }catch(TestUserServiceException e){
    
    }
    checkLevelUpgraded(users.get(1), false); 
}
```
<br>
<br>

#### 트랜잭션 경계설정

```
여러 개의 SQL이 사용되는 작업을 하나의 트랜잭션으로 취급해야 하는 경우도 있다. ex) 은행 입출금. 
복잡한 로직의 흐름 사이에서 정확하게 트랜잭션 경계를 설정하는 일은 매우 중요한 작업이다.
```

